{% comment %}
  Renders a product card

  Accepts:
  - card_product: {Object} Product Liquid object (optional)
  - media_aspect_ratio: {String} Size of the product image card. Values are "square" and "portrait". Default is "square" (optional)
  - image_shape: {String} Image mask to apply to the product image card. Values are "arch", "blob", "chevronleft", "chevronright", "diamond", "parallelogram", and "round". (optional)
  - show_secondary_image: {Boolean} Show the secondary image on hover. Default: false (optional)
  - show_vendor: {Boolean} Show the product vendor. Default: false
  - show_rating: {Boolean} Show the product rating. Default: false
  - extend_height: {Boolean} Card height extends to available container space. Default: true (optional)
  - lazy_load: {Boolean} Image should be lazy loaded. Default: true (optional)
  - skip_styles: {Boolean} Don't include component styles. Useful when rendering multiple product cards in a loop. Default: false (optional)
  - quick_add: {Boolean} Show the quick add button.
  - section_id: {String} The ID of the section that contains this card.
  - horizontal_class: {Boolean} Add a card--horizontal class if set to true. Default: false (optional)
  - horizontal_quick_add: {Boolean} Changes the quick add button styles when set to true. Default: false (optional)
  - placeholder_image: {String} The placeholder image to use when no product exists. Default: 'product-apparel-2' (optional)

  Usage:
  {% render 'card-product', show_vendor: section.settings.show_vendor %}
{% endcomment %}


{% comment %}
  Renders an enhanced product card with tags, reviews, and color options

  Accepts all original parameters plus:
  - show_reviews: {Boolean} Show review count and stars. Default: true
  - show_colors: {Boolean} Show available color options. Default: true
  - show_tags: {Boolean} Show product tags as badges. Default: true
{% endcomment %}

<a href="{{ card_product.url }}" class="pr-card" aria-label="{{ card_product.title | escape }}">
  <div class="img-box">
    {% if show_tags != false %}
      {% if card_product.tags contains 'new' %}
        <div class="tag new-badge">
          <span class="label-style-6">NEW!</span>
        </div>
      {% elsif card_product.tags contains 'best-selling' %}
        <div class="tag best-seller-badge">
          <span class="label-style-7">Best Seller</span>
        </div>
      {% elsif card_product.tags contains 'most-popular' %}
        <div class="tag popular-badge">
          <span class="label-style-6">Most Popular</span>
        </div>
      {% endif %}
    {% endif %}
    
    <img
      src="{{ card_product.featured_image | img_url: '400x400', crop: 'center' }}"
      alt="{{ card_product.featured_image.alt | default: card_product.title | escape }}"
      class="product-img"
      loading="lazy"
      width="260"
      height="230"
      onerror="this.src='{{ placeholder_image | default: 'product-apparel-2' | placeholder_svg_tag }}'"
    />
  </div>
  
  <div class="content-box">
    {% if show_reviews != false %}
      <div class="review-box">
        <div class="star-rating" aria-label="Rating: {{ card_product.metafields.reviews.rating.value.rating | default: 0 }} out of 5">
          {% render 'star-rating', rating: card_product.metafields.reviews.rating.value.rating %}
        </div>
        <div class="title-style-4">
          {{ card_product.metafields.reviews.rating_count | default: 13 }} Reviews
        </div>
      </div>
    {% endif %}
    
    {% if show_colors != false %}
      <div class="color-box">
        <div class="title-style-5">Color</div>
        <div class="color-options">
          {% assign color_option = card_product.options_with_values | where: 'name', 'Color' | first %}
          {% if color_option %}
            {% assign unique_colors = '' %}
            {% for variant in card_product.variants limit: 5 %}
              {% assign color = variant.options[color_option.position - 1] %}
              {% unless unique_colors contains color %}
                <span 
                  class="color-dot" 
                  style="background-color: {{ color | downcase | replace: ' ', '-' }};"
                  aria-label="{{ color }}"
                  data-tooltip="{{ color }}"
                ></span>
                {% assign unique_colors = unique_colors | append: ',' | append: color %}
              {% endunless %}
            {% endfor %}
            {% if card_product.variants.size > 5 %}
              <span class="color-more">+{{ card_product.variants.size | minus: 5 }}</span>
            {% endif %}
          {% endif %}
        </div>
      </div>
    {% endif %}
    
    <h3 class="pr-title">{{ card_product.title }}</h3>
    
    <div class="price">
      {% if card_product.compare_at_price > card_product.price %}
        <span class="compare-price">{{ card_product.compare_at_price | money }}</span>
      {% endif %}
      <span class="current-price">{{ card_product.price | money }}</span>
      {% if card_product.compare_at_price > card_product.price %}
        <span class="sale-badge">
          Save {{ card_product.compare_at_price | minus: card_product.price | money }}
        </span>
      {% endif %}
    </div>
    
    {% if quick_add %}
      <button class="quick-add-btn" data-product-id="{{ card_product.selected_or_first_available_variant.id }}">
        Add to Cart
      </button>
    {% endif %}
  </div>
</a>

<style>
  /* Improved CSS for the product card */
  .pr-card {
    display: block;
    text-decoration: none;
    color: inherit;
    transition: transform 0.3s ease;
  }
  
  .pr-card:hover {
    transform: translateY(-5px);
  }
  
  .tag {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 1;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: bold;
  }
  
  .new-badge { background: #FF4136; color: white; }
  .best-seller-badge { background: #2ECC40; color: white; }
  .popular-badge { background: #FFDC00; color: black; }
  
  .color-options {
    display: flex;
    gap: 8px;
    margin-top: 4px;
  }
  
  .color-dot {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    border: 1px solid #eee;
    cursor: pointer;
  }
  
  .price {
    margin-top: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .compare-price {
    text-decoration: line-through;
    color: #999;
    font-size: 0.9em;
  }
  
  .sale-badge {
    background: #FF4136;
    color: white;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.8em;
  }
  
  .quick-add-btn {
    width: 100%;
    margin-top: 12px;
    padding: 8px;
    background: black;
    color: white;
    border: none;
    cursor: pointer;
  }
</style>